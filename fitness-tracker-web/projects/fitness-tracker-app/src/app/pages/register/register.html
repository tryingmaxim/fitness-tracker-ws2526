<div class="register-container">
  <h1>Registrieren</h1>
  <p>Erstellen Sie Ihr pers&ouml;nliches FitnessTracker-Konto.</p>

  <div class="register-box">
    <div class="alerts" *ngIf="errorMessage || infoMessage">
      <div class="alert error" *ngIf="errorMessage">
        <span class="alert-title">Fehler</span>
        <span class="alert-text">{{ errorMessage }}</span>
      </div>

      <div class="alert success" *ngIf="infoMessage">
        <span class="alert-title">Erfolg</span>
        <span class="alert-text">{{ infoMessage }}</span>
      </div>
    </div>

    <form #regForm="ngForm" (ngSubmit)="onSubmit(regForm)" novalidate>
      <div class="row">
        <div class="field">
          <label for="firstName">Vorname</label>
          <input
            id="firstName"
            name="firstName"
            placeholder="Max"
            required
            [(ngModel)]="formModel.firstName"
            #firstName="ngModel"
            [disabled]="isLoading"
            [class.invalid]="firstName.invalid && (firstName.touched || regForm.submitted)"
          />
          <div class="field-error" *ngIf="firstName.invalid && (firstName.touched || regForm.submitted)">
            Bitte gib deinen Vornamen ein.
          </div>
        </div>

        <div class="field">
          <label for="lastName">Nachname</label>
          <input
            id="lastName"
            name="lastName"
            placeholder="Mustermann"
            required
            [(ngModel)]="formModel.lastName"
            #lastName="ngModel"
            [disabled]="isLoading"
            [class.invalid]="lastName.invalid && (lastName.touched || regForm.submitted)"
          />
          <div class="field-error" *ngIf="lastName.invalid && (lastName.touched || regForm.submitted)">
            Bitte gib deinen Nachnamen ein.
          </div>
        </div>
      </div>

      <label for="email">E-Mail</label>
      <input
        id="email"
        name="email"
        type="email"
        placeholder="E-Mail-Adresse eingeben"
        required
        email
        pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$"
        [(ngModel)]="formModel.email"
        #emailModel="ngModel"
        [disabled]="isLoading"
        [class.invalid]="emailModel.invalid && (emailModel.touched || regForm.submitted)"
      />
      <div class="field-error" *ngIf="emailModel.invalid && (emailModel.touched || regForm.submitted)">
        Bitte gib eine g&uuml;ltige E-Mail-Adresse ein (z. B. name@domain.de).
      </div>

      <div class="row">
        <div class="field">
          <label for="age">Alter</label>
          <input
            id="age"
            name="age"
            type="number"
            min="12"
            max="100"
            placeholder="z. B. 25"
            required
            [(ngModel)]="formModel.age"
            #ageModel="ngModel"
            [disabled]="isLoading"
            [class.invalid]="ageModel.invalid && (ageModel.touched || regForm.submitted)"
          />
          <div class="field-error" *ngIf="ageModel.invalid && (ageModel.touched || regForm.submitted)">
            Bitte gib ein g&uuml;ltiges Alter zwischen 12 und 100 an.
          </div>
        </div>

        <div class="field">
          <label for="gender">Geschlecht (optional)</label>
          <select
            id="gender"
            name="gender"
            [(ngModel)]="formModel.gender"
            [disabled]="isLoading"
          >
            <option value="">Bitte w&auml;hlen</option>
            <option value="m">M&auml;nnlich</option>
            <option value="w">Weiblich</option>
            <option value="d">Divers</option>
          </select>
        </div>
      </div>

      <label for="password">Passwort</label>
      <input
        id="password"
        name="password"
        type="password"
        placeholder="Mind. 8 Zeichen"
        minlength="8"
        required
        [(ngModel)]="formModel.password"
        #passwordModel="ngModel"
        [disabled]="isLoading"
        [class.invalid]="passwordModel.invalid && (passwordModel.touched || regForm.submitted)"
      />
      <div class="field-error" *ngIf="passwordModel.invalid && (passwordModel.touched || regForm.submitted)">
        Passwort muss mindestens 8 Zeichen lang sein.
      </div>

      <label for="passwordConfirm">Passwort best&auml;tigen</label>
      <input
        id="passwordConfirm"
        name="passwordConfirm"
        type="password"
        placeholder="Passwort wiederholen"
        minlength="8"
        required
        [(ngModel)]="formModel.passwordConfirm"
        #passwordConfirmModel="ngModel"
        [disabled]="isLoading"
        [class.invalid]="
          (passwordConfirmModel.invalid && (passwordConfirmModel.touched || regForm.submitted)) ||
          ((passwordConfirmModel.touched || regForm.submitted) &&
            formModel.passwordConfirm &&
            formModel.password !== formModel.passwordConfirm)
        "
      />

      <div class="field-error" *ngIf="passwordConfirmModel.invalid && (passwordConfirmModel.touched || regForm.submitted)">
        Bitte best&auml;tige dein Passwort (mind. 8 Zeichen).
      </div>
      <div class="field-error" *ngIf="(passwordConfirmModel.touched || regForm.submitted) && formModel.passwordConfirm && formModel.password !== formModel.passwordConfirm">
        Die Passw&ouml;rter stimmen nicht &uuml;berein.
      </div>

      <div class="terms-container">
        <input
          type="checkbox"
          id="terms"
          name="terms"
          required
          [(ngModel)]="formModel.terms"
          #termsModel="ngModel"
          [disabled]="isLoading"
        />
        <label for="terms" class="terms-label">
          Ich akzeptiere die
          <a routerLink="/agb">Datenschutzerkl&auml;rung und die Nutzungsbedingungen.</a>
        </label>
      </div>

      <div class="field-error center" *ngIf="termsModel.invalid && (termsModel.touched || regForm.submitted)">
        Bitte akzeptiere die Nutzungsbedingungen.
      </div>

      <button type="submit" [disabled]="isLoading">
        {{ isLoading ? 'Wird erstellt...' : 'Konto erstellen' }}
      </button>
    </form>
  </div>

  <div class="login-hint">
    Sie haben bereits ein Konto?
    <a routerLink="/login">Hier anmelden</a>.
  </div>
</div>
