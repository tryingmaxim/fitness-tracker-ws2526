<!-- src/app/private/exercises/exercises.html -->

<div class="page">
  <h1>Übungen</h1>
  <!-- Untertitel: sagt kurz, was man hier machen kann -->
  <p class="sub">Verwalte deine angelegten Übungen und bearbeite die Details.</p>

  <!-- Meldungen: werden nur angezeigt, wenn error oder info gesetzt ist -->
  <div class="alerts" *ngIf="error || info">
    <div class="alert error" *ngIf="error">{{ error }}</div>
    <div class="alert info" *ngIf="info">{{ info }}</div>
  </div>

  <!-- Bereich zum neue Übungen anlegen -->
  <section class="panel create-panel">
    <h2>Neue Übung anlegen</h2>

    <!-- Kurze Erklärung für den User -->
    <p class="hint">
      Lege hier neue Übungen an. Name, Kategorie und Muskelgruppen sind Pflichtfelder.
    </p>

    <!-- Formular: Beim Absenden wird addExercise() ausgeführt -->
    <form class="form" #createForm="ngForm" (ngSubmit)="addExercise(createForm)">
      <!-- Eingaben werden mit ngModel direkt an form gebunden -->
      <input [(ngModel)]="form.name" name="name" placeholder="Name (z.B. Bankdrücken)" required />

      <input
        [(ngModel)]="form.category"
        name="category"
        placeholder="Kategorie (z.B. Freihantel)"
        required
      />

      <input
        [(ngModel)]="form.muscleGroups"
        name="muscleGroups"
        placeholder="Muskelgruppen (z.B.Trizeps)"
        required
      />

      <textarea
        [(ngModel)]="form.description"
        name="description"
        placeholder="Beschreibung (optional)"
      ></textarea>

      <!-- Button zeigt während submitting einen Lade-Text -->
      <button type="submit" [disabled]="submitting">
        {{ submitting ? 'Wird angelegt...' : 'Hinzufügen' }}
      </button>
    </form>
  </section>

  <!-- Hauptlayout: links Liste, rechts Details -->
  <div class="layout">

    <!-- Linke Seite: Übersicht der Übungen -->
    <section class="panel overview">
      <div class="overview-head">
        <h2>Übersicht</h2>
        <!-- Zeigt, wie viele Übungen vorhanden sind -->
        <span class="count-badge">{{ exercises.length }}</span>
      </div>

      <!-- Live-Suche: filtert die Übungen während der Eingabe -->
      <input
        type="text"
        class="exercise-search"
        placeholder="Übung suchen..."
        [(ngModel)]="exerciseOverviewSearch"
        (input)="onExerciseOverviewSearchChange()"
      />

      <!-- Meldungen beim Laden oder wenn leer -->
      <p class="muted" *ngIf="loading">Übungen werden geladen...</p>
      <p class="muted" *ngIf="!loading && !filteredExerciseOverview.length">
        Keine Übung gefunden.
      </p>

      <!-- Liste der gefilterten Übungen -->
      <ul class="list">
        <li
          *ngFor="let ex of filteredExerciseOverview; trackBy: trackByExercise"
          (click)="selectExercise(ex)"
          [class.active]="selectedExercise?.id === ex.id"
        >
          <div class="exercise-info">
            <div>
              <h3>{{ ex.name }}</h3>

              <p class="meta">
                Kategorie:
                <strong>{{ ex.category || '–' }}</strong>
              </p>

              <!-- Muskelgruppen oder Ersatztext -->
              <p class="meta" *ngIf="ex.muscleGroups; else noMuscles">
                Muskelgruppen: {{ ex.muscleGroups }}
              </p>
              <ng-template #noMuscles>
                <p class="meta muted">Keine Muskelgruppen hinterlegt</p>
              </ng-template>

              <!-- Beschreibung oder Ersatztext -->
              <p class="desc" *ngIf="ex.description; else noDesc">
                {{ ex.description }}
              </p>
              <ng-template #noDesc>
                <p class="desc muted">Keine Beschreibung hinterlegt</p>
              </ng-template>
            </div>
          </div>

          <!-- Buttons: Details anzeigen oder löschen -->
          <div class="exercise-actions">
            <button
              type="button"
              class="ghost"
              (click)="selectExercise(ex); $event.stopPropagation()"
            >
              Details
            </button>

            <button type="button" class="danger" (click)="deleteExercise(ex, $event)">
              Löschen
            </button>
          </div>
        </li>
      </ul>
    </section>

    <!-- Rechte Seite: Details der ausgewählten Übung -->
    <section class="panel details" *ngIf="selectedExercise; else selectHint">
      <div class="details-head">
        <button type="button" class="back" (click)="resetSelection()">
          ← Zurück zur Übersicht
        </button>
        <h2>Details: {{ selectedExercise.name }}</h2>
      </div>

      <!-- Formular: Änderungen speichern -->
      <form class="edit-form" (ngSubmit)="saveSelected()">

        <label for="editName">Name</label>
        <input id="editName" name="editName" [(ngModel)]="editForm.name" required />

        <label for="editCategory">Kategorie</label>
        <input id="editCategory" name="editCategory" [(ngModel)]="editForm.category" required />

        <label for="editMuscles">Muskelgruppen</label>
        <input
          id="editMuscles"
          name="editMuscles"
          [(ngModel)]="editForm.muscleGroups"
          required
        />

        <label for="editDesc">Beschreibung</label>
        <textarea id="editDesc" name="editDesc" [(ngModel)]="editForm.description"></textarea>

        <!-- Button zeigt Lade-Status während saving -->
        <button type="submit" [disabled]="saving">
          {{ saving ? 'Speichern...' : 'Änderungen speichern' }}
        </button>
      </form>
    </section>

    <!-- Hinweis, wenn keine Übung ausgewählt wurde -->
    <ng-template #selectHint>
      <section class="panel details placeholder">
        <p>Wähle eine Übung aus der Übersicht, um Details zu bearbeiten.</p>
      </section>
    </ng-template>

  </div>
</div>
